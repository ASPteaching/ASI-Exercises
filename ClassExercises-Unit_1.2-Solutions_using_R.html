<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.47">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alex Sanchez-Pla">
<meta name="dcterms.date" content="2024-10-17">

<title>Significance and Hypothesis Testing exercises. Part 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ClassExercises-Unit_1.2-Solutions_using_R_files/libs/clipboard/clipboard.min.js"></script>
<script src="ClassExercises-Unit_1.2-Solutions_using_R_files/libs/quarto-html/quarto.js"></script>
<script src="ClassExercises-Unit_1.2-Solutions_using_R_files/libs/quarto-html/popper.min.js"></script>
<script src="ClassExercises-Unit_1.2-Solutions_using_R_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ClassExercises-Unit_1.2-Solutions_using_R_files/libs/quarto-html/anchor.min.js"></script>
<link href="ClassExercises-Unit_1.2-Solutions_using_R_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ClassExercises-Unit_1.2-Solutions_using_R_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ClassExercises-Unit_1.2-Solutions_using_R_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ClassExercises-Unit_1.2-Solutions_using_R_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ClassExercises-Unit_1.2-Solutions_using_R_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#problem-1" id="toc-problem-1" class="nav-link active" data-scroll-target="#problem-1">Problem 1</a>
  <ul class="collapse">
  <li><a href="#paired-samples-with-numerical-values" id="toc-paired-samples-with-numerical-values" class="nav-link" data-scroll-target="#paired-samples-with-numerical-values">Paired samples with numerical values</a></li>
  <li><a href="#paired-samples.-only-signs" id="toc-paired-samples.-only-signs" class="nav-link" data-scroll-target="#paired-samples.-only-signs">Paired samples. Only signs</a></li>
  <li><a href="#independent-samples" id="toc-independent-samples" class="nav-link" data-scroll-target="#independent-samples">Independent samples</a></li>
  <li><a href="#a-hypothesis-testing-approach" id="toc-a-hypothesis-testing-approach" class="nav-link" data-scroll-target="#a-hypothesis-testing-approach">A Hypothesis testing approach</a>
  <ul class="collapse">
  <li><a href="#paired-samples-with-values" id="toc-paired-samples-with-values" class="nav-link" data-scroll-target="#paired-samples-with-values">Paired samples with values</a></li>
  </ul></li>
  <li><a href="#paired-samples-with-signs" id="toc-paired-samples-with-signs" class="nav-link" data-scroll-target="#paired-samples-with-signs">Paired samples with signs</a></li>
  <li><a href="#independent-samples-1" id="toc-independent-samples-1" class="nav-link" data-scroll-target="#independent-samples-1">Independent samples</a></li>
  </ul></li>
  <li><a href="#problem-2" id="toc-problem-2" class="nav-link" data-scroll-target="#problem-2">Problem 2</a>
  <ul class="collapse">
  <li><a href="#critical-region" id="toc-critical-region" class="nav-link" data-scroll-target="#critical-region">Critical region</a></li>
  <li><a href="#type-i-error-probability." id="toc-type-i-error-probability." class="nav-link" data-scroll-target="#type-i-error-probability.">Type I error probability.</a></li>
  <li><a href="#power-function" id="toc-power-function" class="nav-link" data-scroll-target="#power-function">Power function</a></li>
  <li><a href="#the-continuity-correction" id="toc-the-continuity-correction" class="nav-link" data-scroll-target="#the-continuity-correction">The continuity correction</a></li>
  </ul></li>
  <li><a href="#problem-3" id="toc-problem-3" class="nav-link" data-scroll-target="#problem-3">Problem 3</a>
  <ul class="collapse">
  <li><a href="#power-function-1" id="toc-power-function-1" class="nav-link" data-scroll-target="#power-function-1">Power function</a></li>
  <li><a href="#size-of-the-procedure" id="toc-size-of-the-procedure" class="nav-link" data-scroll-target="#size-of-the-procedure">Size of the procedure</a></li>
  </ul></li>
  <li><a href="#problem-4" id="toc-problem-4" class="nav-link" data-scroll-target="#problem-4">Problem 4</a></li>
  <li><a href="#problem-5" id="toc-problem-5" class="nav-link" data-scroll-target="#problem-5">Problem 5</a></li>
  <li><a href="#problem-9---permutation-tests-with-r" id="toc-problem-9---permutation-tests-with-r" class="nav-link" data-scroll-target="#problem-9---permutation-tests-with-r">Problem 9 - Permutation tests with R</a>
  <ul class="collapse">
  <li><a href="#permutation-test" id="toc-permutation-test" class="nav-link" data-scroll-target="#permutation-test">Permutation test</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="ClassExercises-Unit_1.2-Solutions_using_R.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Significance and Hypothesis Testing exercises. Part 1</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alex Sanchez-Pla </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 17, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="problem-1" class="level1">
<h1>Problem 1</h1>
<p>The following figures (Cushny and Peebles’ data), are quoted quote by R.A. Fisher <span class="math inline">\({ }^{1}\)</span> from a “Student’s” paper, and show the result of an experiment with ten patients on the effect of two supposedly soporific drugs, <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>, in producing sleep.</p>
<p>The last column gives a controlled comparison of the efficacy of the two drugs as soporifics, (a) Propose and apply a test of significance to help decide if both drugs can be considered to have the same soporific effect. (b) Answer the previous question assuming that the researchers had decide to record only the sign of the difference, but not the numerical value. (c) Answer the first question assuming that soporific A and B were not tested on the same subjects but, instead on two independent (not matched) groups of subjects.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">Patient</th>
<th style="text-align: center;">A</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">Difference (B - A).</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">+0.7</td>
<td style="text-align: center;">+1.9</td>
<td style="text-align: center;">+1.2</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">-0.6</td>
<td style="text-align: center;">+0.8</td>
<td style="text-align: center;">+2.4</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">-0.2</td>
<td style="text-align: center;">+1.1</td>
<td style="text-align: center;">+1.3</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">-1.2</td>
<td style="text-align: center;">+0.1</td>
<td style="text-align: center;">+1.3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">-0.1</td>
<td style="text-align: center;">-0.1</td>
<td style="text-align: center;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">+3.4</td>
<td style="text-align: center;">+4.4</td>
<td style="text-align: center;">+1.0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: center;">+3.7</td>
<td style="text-align: center;">+5.5</td>
<td style="text-align: center;">+1.8</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: center;">+0.8</td>
<td style="text-align: center;">+1.6</td>
<td style="text-align: center;">+0.8</td>
</tr>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: center;">0.0</td>
<td style="text-align: center;">+4.6</td>
<td style="text-align: center;">+4.6</td>
</tr>
<tr class="even">
<td style="text-align: center;">10</td>
<td style="text-align: center;">+2.0</td>
<td style="text-align: center;">+3.4</td>
<td style="text-align: center;">+1.4</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Mean <span class="math inline">\((\bar{x})\)</span></td>
<td style="text-align: center;">+0.75</td>
<td style="text-align: center;">+2.33</td>
<td style="text-align: center;">+1.58</td>
</tr>
</tbody>
</table>
<p>Table 1: Additional Hours of Sleep galned by the Use OF TWO TESTED DRUGS</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>drugA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.7</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="sc">-</span><span class="fl">0.2</span>,<span class="sc">-</span><span class="fl">1.2</span>,<span class="sc">-</span><span class="fl">0.1</span>,<span class="fl">3.4</span>,<span class="fl">3.7</span>, <span class="fl">0.8</span>,<span class="dv">0</span>  ,<span class="fl">2.0</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>drugB <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.9</span>,<span class="fl">0.8</span> ,<span class="fl">1.1</span>, <span class="fl">0.1</span> ,<span class="sc">-</span><span class="fl">0.1</span>,<span class="fl">4.4</span>,<span class="fl">5.5</span>, <span class="fl">1.6</span>,<span class="fl">4.6</span>,<span class="fl">3.4</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>BvsA <span class="ot">&lt;-</span> drugB<span class="sc">-</span>drugA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we compute observed statistics for each test and then the associated p-values we obtain:</p>
<section id="paired-samples-with-numerical-values" class="level2">
<h2 class="anchored" data-anchor-id="paired-samples-with-numerical-values">Paired samples with numerical values</h2>
<p>Here we can state the null hypothesis as: <span class="math inline">\(H_0: \mu_D = 0\)</span></p>
<p>We can rely on a student’s T statistic, tha, as a corollary of Fisher’s Theorem, is known to follow a <span class="math inline">\(t_n-1\)</span> distribution. <span class="math display">\[
\frac{\overline{X}-\mu}{S/\sqrt{n}}\sim t_{n-1}, \text{where: }  S^2=\frac{1}{n-1}\sum_{i=1}^n (X_i-\overline{X})^2.
\]</span></p>
<p>If we compute the observed value of the test statistic yields: <span class="math inline">\(\tilde t_{obs}=3.91\)</span>.</p>
<p>The p-value is defined as <span class="math inline">\(P[T \geq \tilde t_{obs}| H_0] = P[t_{n-1}\tilde t_{obs}| H_0]\)</span></p>
<p>This can be computed in r as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pt</span>(<span class="fl">3.91</span>,<span class="dv">9</span>,<span class="at">lower.tail=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.001782377</code></pre>
</div>
</div>
<p>The p-value is very small so it is very unlikely that the observed difference is due to chance which leads us to decide <span class="math inline">\(H_0\)</span> is not acceptable, that is, <em>there is a significant difference between the drugs</em>.</p>
</section>
<section id="paired-samples.-only-signs" class="level2">
<h2 class="anchored" data-anchor-id="paired-samples.-only-signs">Paired samples. Only signs</h2>
<p>Assume we have paired samples and only the signs of the differences</p>
<p>In that case, although we still aim at determining if the drugs have the same effect we can only work with the “number of positive signs”.</p>
<p>The statistic “<span class="math inline">\(\mathrm{N}=\)</span> # of positive signs” in a sample of <span class="math inline">\(n\)</span> observations where the probability of obtaining a positive sign is <span class="math inline">\(p\)</span> follows a binomial distribution:</p>
<p><span class="math display">\[
N_{n, p} \sim B(n, p)
\]</span></p>
<p>Now the null hypothesis can be stated as: <span class="math inline">\(H_{0}: p=1 / 2\)</span> which means that under this null hypothesis</p>
<p><span class="math display">\[
N_{n . p} \sim \operatorname{Bin}(n=10, p=0.5)
\]</span></p>
<p>Now, given that we he observed 9 positive signs, the observed value of the statistic is <span class="math inline">\(\tilde{n}_{\text {obs }}=9\)</span> and the p-value can be computed as:</p>
<p><span class="math display">\[
P\left[N_{n, p} \geq \tilde{n}_{\text {obs }} \mid H_{0}\right]=P\left[N_{10,0.5} \geq \tilde{n}_{\text {obs }}\right]=p(N=9)+p(N=10)
\]</span></p>
<p>This can be computed using R as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>p10<span class="ot">&lt;-</span> <span class="fu">dbinom</span>( <span class="dv">10</span>,<span class="dv">10</span>,<span class="fl">0.5</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>p9<span class="ot">&lt;-</span> <span class="fu">dbinom</span> (<span class="dv">9</span>,<span class="dv">10</span>,<span class="fl">0.5</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>p9<span class="sc">+</span>p10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01074219</code></pre>
</div>
</div>
<p>The p-value is still small (though not so much as in the previous case) so it is unlikely that the observed difference is due to chance which leads us to decide <span class="math inline">\(H_{0}\)</span> is not acceptable, that is, there is a significant difference between the drugs.</p>
<p>Notice that in this case, the strength of evidence against <span class="math inline">\(H_{0}\)</span> reflected by the p-value is smaller, which is reasonable given that we have less information about how the data deviate from the hypothesis.</p>
</section>
<section id="independent-samples" class="level2">
<h2 class="anchored" data-anchor-id="independent-samples">Independent samples</h2>
<p>Assume samples are independent and only the signs of the differences</p>
<p>If for whatever reason the drugs had been tested on distinct patients, the question about if the drugs have the same effect may be re-stated, for instance as: <span class="math inline">\(H_{0}: \mu_{A}=\mu_{B}\)</span>.</p>
<p>In this case we may, again, rely on a statistic whose distribution is known as a corollary of Fisher’s theorem.</p>
<p>Given two independent simple random samples:</p>
<p><span class="math display">\[
X_{1}, X_{2}, \ldots, X_{n_{1}} \stackrel{i i d}{\sim} N\left(\mu_{1}, \sigma_{1}\right) \quad Y_{1}, Y_{2}, \ldots, Y_{n_{2}} \stackrel{i i d}{\sim} N\left(\mu_{2}, \sigma_{2}\right)
\]</span></p>
<p>The statistic</p>
<p><span class="math display">\[
\frac{\bar{X}-\bar{Y}-\left(\mu_{1}-\mu_{2}\right)}{\sqrt{\left(n_{1}-1\right) S_{1}^{2} / \sigma_{1}^{2}+\left(n_{2}-1\right) S_{2}^{2} / \sigma_{2}^{2}}} \sqrt{\frac{n_{1}+n_{2}-2}{\sigma_{1}^{2} / n_{1}+\sigma_{2}^{2} / n_{2}}}
\]</span></p>
<p>is distributed as a Student’s <span class="math inline">\(t\)</span> with <span class="math inline">\(n_{1}+n_{2}-2\)</span> degrees of freedom. Under the assumption that <span class="math inline">\(\sigma_{1}^{2}=\sigma_{2}^{2}\)</span> and <span class="math inline">\(n_{1}=n_{2}, \sigma^{2}\)</span> cancels out and the statistic can be computed for the sample.</p>
<p>Computing the value of the statistic from the sample yields: <span class="math inline">\(\tilde{t}_{\text {obs}}= 1.80\)</span> and using R the p-value can be computed as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pt</span> (<span class="at">q=</span><span class="fl">1.80</span>, <span class="at">df=</span><span class="dv">18</span>, <span class="at">lower.tail=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.04432216</code></pre>
</div>
</div>
<p>Notice that this p-value can lead to the temptation to discuss significance with respect to a threshold, which should be avoided! Instead it is preferable to notice that there is not much evidence leading to accept there is a significant difference between the drugs.</p>
</section>
<section id="a-hypothesis-testing-approach" class="level2">
<h2 class="anchored" data-anchor-id="a-hypothesis-testing-approach">A Hypothesis testing approach</h2>
<section id="paired-samples-with-values" class="level3">
<h3 class="anchored" data-anchor-id="paired-samples-with-values">Paired samples with values</h3>
<p><span class="math display">\[
H_0: \mu_D = 0; \quad H_1: \mu_D &gt; 0
\]</span> Student’s T-test is the optimal test for this procedure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(BvsA, <span class="at">alternative =</span> <span class="st">"greater"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  BvsA
t = 3.9128, df = 9, p-value = 0.001775
alternative hypothesis: true mean is greater than 0
95 percent confidence interval:
 0.7866405       Inf
sample estimates:
mean of x 
     1.48 </code></pre>
</div>
</div>
</section>
</section>
<section id="paired-samples-with-signs" class="level2">
<h2 class="anchored" data-anchor-id="paired-samples-with-signs">Paired samples with signs</h2>
<p><span class="math display">\[
H_0: \# \text{positive signs} = \# \text{negative signs}
\]</span> There is no optimal test for this problem but the signs tests or bintest provides a good approximation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binom.test</span> (<span class="dv">9</span>,<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Exact binomial test

data:  9 and 10
number of successes = 9, number of trials = 10, p-value = 0.02148
alternative hypothesis: true probability of success is not equal to 0.5
95 percent confidence interval:
 0.5549839 0.9974714
sample estimates:
probability of success 
                   0.9 </code></pre>
</div>
</div>
</section>
<section id="independent-samples-1" class="level2">
<h2 class="anchored" data-anchor-id="independent-samples-1">Independent samples</h2>
<p>Under the assumption that variances are equal the two-sample t-test provides an optimal solution for this problem</p>
<p><span class="math display">\[
H_0: \mu_A = \mu_B; \quad H_0: \mu_A &lt; \mu_B;
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(drugB,drugA, <span class="at">alternative =</span> <span class="st">"greater"</span>, <span class="at">var.equal=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two Sample t-test

data:  drugB and drugA
t = 1.7964, df = 18, p-value = 0.04461
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 0.05138695        Inf
sample estimates:
mean of x mean of y 
     2.33      0.85 </code></pre>
</div>
</div>
</section>
</section>
<section id="problem-2" class="level1">
<h1>Problem 2</h1>
<p>Assume a certain process that leads to a TRUE/FALSE decision is expected to be <em>fair</em>, wihch means that either TRUE or FALSE are expected to habppen with probability 0.5</p>
<p>In order to check this <em>fairness</em>, from time to time, the process is repeated 100 times and the number of TRUE results is recorded. If this number is above 60 or below 40 the process is declared <em>out-of-control</em> or <em>unfair</em> and it is re-adjusted.</p>
<ol type="a">
<li><p>Show how to turn this decision rule into a test with critical region <span class="math inline">\(W=\{\tilde x  \,s.t. \, |X-50| &gt; 10\}\)</span></p></li>
<li><p>Calculate the probability of the type I error for the test associated with <span class="math inline">\(W\)</span>.</p></li>
</ol>
<section id="critical-region" class="level2">
<h2 class="anchored" data-anchor-id="critical-region">Critical region</h2>
<p>A subset of the sampling space <span class="math inline">\(W \in \Omega\)</span> is the critical region of a test with null hypothesis <span class="math inline">\(H_0\)</span> if it is verified that, for any sample <span class="math inline">\(\tilde x\)</span> <span class="math display">\[
P[\tilde x \in W \vert H_0 \text{ true}] \leq \alpha,
\]</span></p>
<p>Where <span class="math inline">\(\alpha\)</span> is called the size of the test. When we work with the equality <span class="math inline">\(P[\tilde x \in W \vert H_0 \text{ true}] = \alpha\)</span>, <span class="math inline">\(\alpha\)</span> is said to be the <em>significance level</em> of the test and also the <em>Type I error probability</em>.</p>
<p>Now, if we consider the random variable <span class="math inline">\(X\)</span>: “number of TRUE results in 100 repeats of the process”, it happens that <span class="math inline">\(X\)</span> has a Binomial distribution with parameters <span class="math inline">\(n=100\)</span> and <span class="math inline">\(p\)</span> unknown, and the 100 repeats of the process is equivalent to sampling one observation of <span class="math inline">\(X\)</span>.</p>
<p>This way to define the process allows us to re-state the null hypothesis (“The process is fair”) as</p>
<p><span class="math display">\[
H_0: p=0.5,\qquad H_1:\, p\neq 0.5
\]</span> So the form of the critical region is:</p>
<p><span class="math display">\[
P[\tilde x \in W \vert H_0 \text{ true}] = P[\tilde x \in W \vert p=0.5] = P[|X-50| &gt; 10|p=0.5]
\]</span> This can be re-stated by saying that <span class="math inline">\(W\)</span> is <em>the procedure that rejects</em> <span class="math inline">\(H_{0}: p=0.5\)</span> in favour of <span class="math inline">\(H_{A}: p \neq 0.5\)</span> when <span class="math inline">\(|X-50|&gt;10\)</span>_.</p>
<p>Note btw that <span class="math inline">\(X\)</span> is a binomial distribution where <span class="math inline">\(n\)</span> is big and <span class="math inline">\(p\)</span> not small so the (Laplace-De Moivere) CLTheorem can be used to compute probabilities based on the Normal approximation to a Binomial.</p>
<p>Next section shows how to do it applying a <em>continuity correction</em> to compensat from the fact that, even if <span class="math inline">\(n\)</span> is big values of <span class="math inline">\(X\)</span> are discrete, while the distribution used for the approximation is continuous.</p>
</section>
<section id="type-i-error-probability." class="level2">
<h2 class="anchored" data-anchor-id="type-i-error-probability.">Type I error probability.</h2>
<p>Calculate the probability of the type I error for the test associated with <span class="math inline">\(W\)</span>.</p>
<p><span class="math display">\[
\begin{aligned}
P(\text { Type I error }) &amp; =P(|X-50|&gt;10 \mid p=0.5)=\\
&amp; = P(X&gt;60 \text { o } X&lt;40 \mid p=0.5) \\
&amp; =1-P(40 \leq X \leq 60 \mid p=0.5) = [\text {continuity correction}] = \\
&amp; =1-P\left(\frac{39.5-100 p}{\sqrt{100 p(1-p)}} \leq Z \leq \frac{60.5-100 p}{\sqrt{100 p(1-p)}}\right) \\
&amp; =1-P\left(\frac{39.5-50}{\sqrt{25}} \leq Z \leq \frac{60.5-50}{\sqrt{25}}\right) \\
&amp; =1-P(-2.1 \leq Z \leq 2.1) \\
&amp; =1-(\Phi(2.1)-\Phi(-2.1))=1-(0.9821-0.0179)=0.0357
\end{aligned}
\]</span></p>
<p>Using R this can be computed as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> .<span class="dv">5</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>Type.I.error.prob <span class="ot">&lt;-</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> (  <span class="fu">pnorm</span>((<span class="fl">60.5</span> <span class="sc">-</span> n<span class="sc">*</span>p)<span class="sc">/</span><span class="fu">sqrt</span>(n<span class="sc">*</span>p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p))) </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>       <span class="sc">-</span> <span class="fu">pnorm</span>((<span class="fl">39.5</span> <span class="sc">-</span> n<span class="sc">*</span>p)<span class="sc">/</span><span class="fu">sqrt</span>(n<span class="sc">*</span>p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p))))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Type.I.error.prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03572884</code></pre>
</div>
</div>
<p>In R, we could have directly used the binomial distribution</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>Type.I.error.prob_2 <span class="ot">=</span> <span class="fu">pbinom</span>(<span class="at">q=</span> <span class="dv">60</span>, <span class="at">size=</span> n, <span class="at">prob =</span> p, <span class="at">lower.tail=</span><span class="cn">TRUE</span>) <span class="sc">-</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pbinom</span>(<span class="at">q=</span> <span class="dv">40</span>, <span class="at">size=</span> n, <span class="at">prob =</span> p, <span class="at">lower.tail=</span><span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="power-function" class="level2">
<h2 class="anchored" data-anchor-id="power-function">Power function</h2>
<p>The power function is obtained by expressing the power of the test as a function of the parameter’s values.</p>
<p><span class="math display">\[
\begin{aligned}
P\left(\mathbb{x}\notin W \,\vert \, p\right) &amp; = P(|X-50| \leq 10 \mid p)=\\
&amp; = P( 40 \leq X \leq 60 \mid p) = [\text {continuity correction}] = \\
&amp; = P\left(\frac{39.5-100 p}{\sqrt{100 p(1-p)}} \leq Z \leq \frac{60.5-100 p}{\sqrt{100 p(1-p)}}\right) \\
&amp; =\left(\Phi\left(\frac{60.5-100 p}{\sqrt{100 p(1-p)}}\right)-\Phi\left(\frac{39.5-100 p}{\sqrt{100 p(1-p)}}\right)\right)
\end{aligned}
\]</span></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;"><span class="math inline">\(p\)</span></th>
<th style="text-align: right;">li</th>
<th style="text-align: right;">ls</th>
<th style="text-align: center;"><span class="math inline">\(\Phi(l i)\)</span></th>
<th style="text-align: center;"><span class="math inline">\(\Phi(l s)\)</span></th>
<th style="text-align: center;">Power</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.20</td>
<td style="text-align: right;">4.8750</td>
<td style="text-align: right;">10.125</td>
<td style="text-align: center;">1.0000</td>
<td style="text-align: center;">1.0000</td>
<td style="text-align: center;">1.0000</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.25</td>
<td style="text-align: right;">3.3486</td>
<td style="text-align: right;">8.1984</td>
<td style="text-align: center;">0.9996</td>
<td style="text-align: center;">1.0000</td>
<td style="text-align: center;">0.9996</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.30</td>
<td style="text-align: right;">2.0731</td>
<td style="text-align: right;">6.6556</td>
<td style="text-align: center;">0.9809</td>
<td style="text-align: center;">1.0000</td>
<td style="text-align: center;">0.9809</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.35</td>
<td style="text-align: right;">0.9435</td>
<td style="text-align: right;">5.3463</td>
<td style="text-align: center;">0.8273</td>
<td style="text-align: center;">1.0000</td>
<td style="text-align: center;">0.8273</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.40</td>
<td style="text-align: right;">-0.1021</td>
<td style="text-align: right;">4.1845</td>
<td style="text-align: center;">0.4594</td>
<td style="text-align: center;">1.0000</td>
<td style="text-align: center;">0.4594</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.45</td>
<td style="text-align: right;">-1.1055</td>
<td style="text-align: right;">3.1156</td>
<td style="text-align: center;">0.1345</td>
<td style="text-align: center;">0.9991</td>
<td style="text-align: center;">0.1354</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.50</td>
<td style="text-align: right;">-2.1000</td>
<td style="text-align: right;">2.1000</td>
<td style="text-align: center;">0.0179</td>
<td style="text-align: center;">0.9821</td>
<td style="text-align: center;">0.0357</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.55</td>
<td style="text-align: right;">-3.1156</td>
<td style="text-align: right;">1.1055</td>
<td style="text-align: center;">0.0009</td>
<td style="text-align: center;">0.8655</td>
<td style="text-align: center;">0.1354</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.60</td>
<td style="text-align: right;">-4.1845</td>
<td style="text-align: right;">0.1021</td>
<td style="text-align: center;">0.0000</td>
<td style="text-align: center;">0.5406</td>
<td style="text-align: center;">0.4594</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.65</td>
<td style="text-align: right;">-5.3463</td>
<td style="text-align: right;">-0.9435</td>
<td style="text-align: center;">0.0000</td>
<td style="text-align: center;">0.1727</td>
<td style="text-align: center;">0.8273</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.70</td>
<td style="text-align: right;">-6.6556</td>
<td style="text-align: right;">-2.0731</td>
<td style="text-align: center;">0.0000</td>
<td style="text-align: center;">0.0191</td>
<td style="text-align: center;">0.9809</td>
</tr>
<tr class="even">
<td style="text-align: center;">0.75</td>
<td style="text-align: right;">-8.1984</td>
<td style="text-align: right;">-3.3486</td>
<td style="text-align: center;">0.0000</td>
<td style="text-align: center;">0.0004</td>
<td style="text-align: center;">0.9996</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0.80</td>
<td style="text-align: right;">-10.125</td>
<td style="text-align: right;">-4.8750</td>
<td style="text-align: center;">0.0000</td>
<td style="text-align: center;">0.0000</td>
<td style="text-align: center;">1.0000</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(.<span class="dv">01</span>,.<span class="dv">99</span>,<span class="at">by=</span>.<span class="dv">01</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>power.p <span class="ot">&lt;-</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> (  <span class="fu">pnorm</span>((<span class="fl">60.5</span> <span class="sc">-</span> n<span class="sc">*</span>p)<span class="sc">/</span><span class="fu">sqrt</span>(n<span class="sc">*</span>p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p))) </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>       <span class="sc">-</span> <span class="fu">pnorm</span>((<span class="fl">39.5</span> <span class="sc">-</span> n<span class="sc">*</span>p)<span class="sc">/</span><span class="fu">sqrt</span>(n<span class="sc">*</span>p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p))))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p,power.p,<span class="at">type=</span><span class="st">"l"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>.<span class="dv">5</span>,<span class="at">col=</span><span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ClassExercises-Unit_1.2-Solutions_using_R_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-continuity-correction" class="level2">
<h2 class="anchored" data-anchor-id="the-continuity-correction">The continuity correction</h2>
<p>See <a href="https://www.drdawnwright.com/continuity-correction-filling-the-cracks/">this intuitive eplanation</a></p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="problem-3" class="level1">
<h1>Problem 3</h1>
<p>Let <span class="math inline">\(X_1, \ldots, X_n\)</span> be a simple random sample from a Uniform distribution on<span class="math inline">\((0,\theta)\)</span>. We would like to test <span class="math inline">\(H_0: \theta\geq 2\)</span> versus <span class="math inline">\(H_1: \theta&lt;2\)</span>. Let <span class="math inline">\(Y_n=max (X_1,\ldots,X_n)\)</span> and consider the procedure that has as critical region all the results such that <span class="math inline">\(Y_n\leq 1.5\)</span>.</p>
<ol type="a">
<li>Find the power function of such procedure.</li>
<li>Calculate the size of the procedure.</li>
</ol>
<section id="power-function-1" class="level2">
<h2 class="anchored" data-anchor-id="power-function-1">Power function</h2>
<p><span class="math display">\[
F_{Y_{(n)}}(y) = (F_X(y))^{n} = \left( \frac{y}{\theta} \right)^n
\]</span></p>
<p><span class="math display">\[
\Pi(\theta) = P\left( Y_{(n)} \leq \frac{\frac{3}{2}}{\theta}\right)= \left(\frac{1.5}{\theta}\right)^n
\]</span></p>
<p>if <span class="math inline">\(\theta \leq \frac{3}{2}\)</span> then <span class="math inline">\(Y_{(n)} \leq  \frac{3}{2}\)</span> and <span class="math inline">\(P\left( Y_{(n)} \leq \frac{\frac{3}{2}}{\theta}\right) = 1 \rightarrow \Pi(\theta) = 1\)</span></p>
<p>if <span class="math inline">\(\theta &gt; \frac{3}{2}\)</span> then <span class="math inline">\(P\left( Y_{(n)} \leq \frac{\frac{3}{2}}{\theta}\right)= F_{Y_{(n)}}(\frac{3}{2}) =  \left(\frac{1.5}{\theta}\right)^n\)</span></p>
</section>
<section id="size-of-the-procedure" class="level2">
<h2 class="anchored" data-anchor-id="size-of-the-procedure">Size of the procedure</h2>
<p><span class="math display">\[
\mbox{size } = \alpha = \Pi(2) = \left( \frac{3}{4} \right)^n
\]</span></p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="problem-4" class="level1">
<h1>Problem 4</h1>
<!-- % de Chiara & Hesterberg, exemple  8.15 -->
<p>A team of researchers plans a study to see if a certain drug can increase the speed at which mice move through a maze. An average decrease of 2 seconds through the maze would be considered effective, so the researchers would like to have a good chance of detecting a change this large or larger. Would 20 mice be a large enough sample? Assume the standard deviation is <span class="math inline">\(\sigma=3 \mathrm{sec}\)</span>. and that the researchers will use a significance level of <span class="math inline">\(\alpha=0.05\)</span>.</p>
<p>Let <span class="math inline">\(\mu\)</span> denote the true mean decrease in time through the maze.</p>
<p>Then the researchers are testing <span class="math inline">\(H_{0}: \mu=0\)</span> versus <span class="math inline">\(H_{\mathrm{A}}: \mu&gt;0\)</span>.</p>
<p>If the null hypothesis holds, then the sampling distribution of <span class="math inline">\(\bar{X}\)</span> is normal with mean 0 and standard error <span class="math inline">\(3 / \sqrt{20}=0.6708\)</span>.</p>
<p>Using a one-sided test at <span class="math inline">\(\alpha=0.05\)</span>, the researchers will reject the null hypothesis if the <span class="math inline">\(z\)</span>-score of the test statistic satisfies <span class="math inline">\(Z \geq 1.645\)</span>.</p>
<p>This corresponds to <span class="math inline">\(Z=(\bar{X}-0) / 0.6708 \geq 1.645\)</span> or <span class="math inline">\(\bar{X} \geq 1.1035\)</span>.</p>
<p>So, if the true mean decrease in time is 2 seconds , what is the probability of correctly rejecting the null hypothesis of <span class="math inline">\(\mu=0\)</span> ?</p>
<p><span class="math display">\[
\begin{aligned}
1-\beta &amp; =P\left(\text { Reject } H_{0} \mid H_{\mathrm{A}} \text { true }\right) \\
&amp; =P(\bar{X} \geq 1.1035 \mid \mu=2) \\
&amp; =P\left(\frac{\bar{X}-2}{0.6708} \geq \frac{1.1035-2}{0.6708}\right) \\
&amp; =P(Z \geq-1.3365) \\
&amp; =0.9093
\end{aligned}
\]</span></p>
<p>Thus, the researchers have a <span class="math inline">\(91 \%\)</span> chance of correctly concluding the drug is effective if the true average decrease in time is 2 s .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>pow<span class="ot">&lt;-</span> <span class="fu">power.t.test</span> ( <span class="at">n=</span><span class="dv">20</span>,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta=</span><span class="dv">2</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd=</span><span class="dv">3</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig.level=</span><span class="fl">0.05</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">power=</span><span class="cn">NULL</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">type=</span><span class="st">"one.sample"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">alternative=</span><span class="st">"one.sided"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(pow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     One-sample t test power calculation 

              n = 20
          delta = 2
             sd = 3
      sig.level = 0.05
          power = 0.8902459
    alternative = one.sided</code></pre>
</div>
</div>
<p>Notice that there is a small difference between the analytical solution and the one using the powerfunction because, in the first case we are working with the unrealistic assumption that <span class="math inline">\(\sigma\)</span> is known. The second case (using R) assumes it is unknown and estimated.</p>
<div style="page-break-after: always;"></div>
</section>
<section id="problem-5" class="level1">
<h1>Problem 5</h1>
<!-- % de Chiara & Hesterberg, exemple  8.16 -->
<p>Suppose the researchers in the previous example want a 95% chance of rejecting <span class="math inline">\(H_0:\, \mu = 0\)</span> at <span class="math inline">\(\alpha = 0.01\)</span> if the true change is a 1.5 sec.&nbsp;decrease in time. What is the smallest number of mice that should be included in the study?</p>
<p>On the standard normal curve, <span class="math inline">\(q=2.3264\)</span> is the cutoff value for the upper 0.01 tail (i.e.&nbsp;the 0.99 quantile). Thus, we need <span class="math inline">\((\bar{X}-0) /(3 / \sqrt{n}) \geq 2.3264\)</span>, or <span class="math inline">\(\bar{X} \geq 6.9792 / \sqrt{n}\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Exercise_1_2_4b.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Distributions under the null and alternative hypotheses. Shaded regions represent power (1-beta) and significance level (alfa). Moving the critical value to the left increases power</figcaption>
</figure>
</div>
</div>
</div>
<p>See <a href="https://www.grbio.eu/statmedia/Statmedia_4/">This link</a> for an animation related to this plot</p>
<p>Thus,</p>
<p><span class="math display">\[
\begin{aligned}
0.95 &amp; =P\left(\left.\bar{X} \geq \frac{6.9792}{\sqrt{n}} \right\rvert\, \mu=1.5\right) \\
&amp; =P\left(\frac{\bar{X}-1.5}{3 / \sqrt{n}} \geq \frac{6.9792 / \sqrt{n}-1.5}{3 / \sqrt{n}}\right) \\
&amp; =P\left(Z \geq 2.3264-\frac{1.5}{3 / \sqrt{n}}\right) .
\end{aligned}
\]</span></p>
<p>Using the 0.05 quantile for the standard normal,</p>
<p><span class="math display">\[
-1.645=2.3264-\frac{1.5}{3 / \sqrt{n}}
\]</span></p>
<p>Thus, <span class="math inline">\(n=64\)</span> is the smallest number of mice that the researchers should use. 1 Using R</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.t.test</span>(<span class="at">n=</span><span class="cn">NULL</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta=</span><span class="fl">1.5</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd=</span><span class="dv">3</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig.level=</span><span class="fl">0.01</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">power=</span><span class="fl">0.95</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">type=</span><span class="st">"one.sample"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">alternative=</span><span class="st">"one.sided"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     One-sample t test power calculation 

              n = 65.82776
          delta = 1.5
             sd = 3
      sig.level = 0.01
          power = 0.95
    alternative = one.sided</code></pre>
</div>
</div>
<p>As in the previous exercise there is adifference in results due to the unrealistic assumption that <span class="math inline">\(\sigma\)</span> is known in the first case.</p>
<div style="page-break-after: always;"></div>
<!-- # Problem 7 -->
<!-- The Poisson distribution is discrete, that's why we cannot obtain critical regions having an exact significance level of say $\alpha= 0.05$ or $\alpha= 0.01$ , -->
<!-- Instead, we iterate the computation until we find the value that defines a critical region with size $\leq \alpha$ -->
<!-- ```{r} -->
<!-- k<-0:20 -->
<!-- (alpha.0.k <- (1-ppois(k,10)) ) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- k<-1:10 -->
<!-- (alpha.0.k <- ppois(k-1,10) ) -->
<!-- ``` -->
<!-- # Problem 9 -->
<!-- ```{r} -->
<!-- x <- seq(-3,3,by=.1) -->
<!-- f1 <- exp(-.5*x^2)/sqrt(2*pi) -->
<!-- f2 <- .5*exp(-abs(x)) -->
<!-- plot(x,f1, ylim=c(0,.5), type="l",  col=4, lwd=2, -->
<!--      ylab = "f(x)", main="Testing N(0,1) against Double Exponential") -->
<!-- lines(x,f2, lty=2, col=3, lwd=2) -->
<!-- x0 <- -1 -->
<!-- lines(c(x0,x0),c(0,exp(-.5*x0^ 2)/(2*pi)^.5), lty=2, col=2, lwd=2) -->
<!-- x0 <- 1 -->
<!-- lines(c(x0,x0),c(0,exp(-.5*x0^ 2)/(2*pi)^.5), lty=2, col=2, lwd=2) -->
<!-- abline(h=0,v=0,col=8) -->
<!-- ``` -->
<!-- ## (b) -->
<!-- ```{r} -->
<!-- eta.0 <- 2*(pnorm(-2)) -->
<!-- eta.1 <- exp(-2) -->
<!-- c(eta.0, eta.1) -->
<!-- ``` -->
<!-- ## (c) -->
<!-- ```{r} -->
<!-- eta.0 <- 1 - 2*(pnorm(3/2)-pnorm(1/2)) -->
<!-- eta.1 <- 1 - (exp(-1/2)-exp(-3/2)) -->
<!-- c(eta.0, eta.1) -->
<!-- ``` -->
</section>
<section id="problem-9---permutation-tests-with-r" class="level1">
<h1>Problem 9 - Permutation tests with R</h1>
<p>We wish to compare the mean survival time (in weeks) of two groups of mice which are used used to test a treatment for a liver disease. All mice are affected by the disease and half one group has been treated by a placebo (<span class="math inline">\(y\)</span>) while the other has been given the drug being tested (<span class="math inline">\(z\)</span>). Placebo and treatmen have been assigned at random to an otherwise homogeneous sample of mice. The resulting survival times are: <span class="math display">\[\begin{align*}
z &amp;=&amp; 94, 197, 16, 38, 99, 141, 23\\
y &amp;=&amp; 52, 104, 146, 10, 51, 30, 40, 27, 46.
\end{align*}\]</span></p>
<p><em>a) Assuming the data are exponentially distributed build a likelihood ratio test and use it to test the null hypothesis of mean equality versus the alternative hypothesios that the mean survival times are different.</em></p>
<ol start="2" type="a">
<li><p>Implement a permutation test in R to compare the two group means. Use it with the data and a number of 1000 permutations to obtaina permutation p-value.</p></li>
<li><p>Compare the results of both tests and comment about the pros and cons of each method.</p></li>
</ol>
<section id="permutation-test" class="level2">
<h2 class="anchored" data-anchor-id="permutation-test">Permutation test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">94</span>, <span class="dv">197</span>, <span class="dv">16</span>, <span class="dv">38</span>, <span class="dv">99</span>, <span class="dv">141</span>, <span class="dv">23</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">52</span>, <span class="dv">104</span>, <span class="dv">146</span>, <span class="dv">10</span>, <span class="dv">51</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">27</span>, <span class="dv">46</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We start by computing the <em>oberved difference in means</em>, that is, we calculate the mean and measure the difference</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(z) ; <span class="fu">length</span>(z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 86.85714</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y) ; <span class="fu">length</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 56.22222</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(diffMeans0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(z) <span class="sc">-</span> <span class="fu">mean</span>(y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30.63492</code></pre>
</div>
</div>
<p>Next we perform a two-sided permutation test using the following steps:</p>
<ol type="1">
<li><p>Let us combine the two datasets into a single dataset.</p></li>
<li><p>Randomly assign each data point into either z or y, although we need to maintain the original sample size (n=7) for Z and (n=9) for y.</p></li>
<li><p>After randomization, calculate the relevant statistic by taking the difference between mean(Zi) and mean(Yi).</p></li>
<li><p>Repeat the steps above until we have 10000 statistics.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">c</span>(z, y) <span class="co"># combines the data</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co"># set seed for reproducibility</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>null_dist <span class="ot">&lt;-</span> <span class="fu">c</span>() <span class="co"># declaring a vector to contain the null distributions</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># performs randomization at least 100000</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100000</span>) {</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  shuffled_data <span class="ot">&lt;-</span> <span class="fu">sample</span>(combined_data)  <span class="co"># randomly shuffles the data</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  shuffled_z <span class="ot">&lt;-</span> shuffled_data[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>] <span class="co"># assigns the first seven points to Z</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  shuffled_y <span class="ot">&lt;-</span> shuffled_data[<span class="dv">8</span><span class="sc">:</span><span class="dv">16</span>]  <span class="co"># assigns the last nine points to y</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  null_dist[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(shuffled_z) <span class="sc">-</span> <span class="fu">mean</span>(shuffled_y)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(null_dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ClassExercises-Unit_1.2-Solutions_using_R_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<ol start="5" type="1">
<li><p>Add the numbers of statistics that are equal to or greater the previously computed difference in means: <code>diffMeans0</code>.</p></li>
<li><p>Calculate the p-value of the permutation test by dividing the sum from step 5 by 10000 (the number of randomization performed).</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>(p_value <span class="ot">&lt;-</span> (<span class="fu">sum</span>(null_dist <span class="sc">&gt;=</span> diffMeans0) <span class="sc">+</span> <span class="fu">sum</span>(null_dist <span class="sc">&lt;=</span> <span class="sc">-</span>diffMeans0))<span class="sc">/</span><span class="fu">length</span>(null_dist))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.28004</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>